// This is your Prisma schema file, 
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Role {
  Admin
  Faculty
  Cashier
  Registrar
}

enum Status {
  Active
  Inactive
}

enum EmploymentStatus {
  Hired
  Resigned
}

enum SubmissionStatus {
  Submitted
  Pending
}

enum ContractType {
  Full_Time
  Part_Time
  Probationary
}

enum DayOfWeek {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

model User {
  UserID       Int       @id @default(autoincrement()) // Primary key
  FirstName    String // First name of the user
  LastName     String // Last name of the user
  Email        String    @unique // Email should be unique
  Photo        String // Photo URL or file path
  PasswordHash String // Hashed password
  Role         Role // Enum for user role (e.g., Admin, User, etc.)
  Status       Status    @default(Active) // Enum for user status (e.g., Active, Inactive)
  DateCreated  DateTime  @default(now()) // Automatically set the creation date
  DateModified DateTime? // Optional: Date when the record was last modified
  LastLogin    DateTime? // Optional: Date when the user last logged in

  Faculty      Faculty? // One-to-one relation with Faculty
  Cashier      Cashier? // One-to-one relation with Cashier
  Registrar    Registrar? // One-to-one relation with Registrar
  AIChat       AIChat[] // One-to-many relation with AIChat
  Notification Notification[] // One-to-many relation with Notification
  Report       Report[] // One-to-many relation with Report
  ActivityLog  ActivityLog[] // One-to-many relation with ActivityLog
}

model Faculty {
  FacultyID        Int              @id @default(autoincrement())
  UserID           Int              @unique
  DateOfBirth      DateTime
  Phone            String?
  Address          String?
  EmploymentStatus EmploymentStatus
  HireDate         DateTime
  ResignationDate  DateTime?
  Position         String
  DepartmentID     Int
  ContractID       Int?

  User       User       @relation(fields: [UserID], references: [UserID], onDelete: Cascade)
  Department Department @relation(fields: [DepartmentID], references: [DepartmentID])
  Contract   Contract?  @relation(fields: [ContractID], references: [ContractID])

  Documents Document[] // Faculty can have many Documents
  Schedules Schedule[] // Faculty can have many Schedules
}

model Cashier {
  CashierID    Int       @id @default(autoincrement())
  UserID       Int       @unique
  WorkSchedule String?
  ShiftStart   DateTime?
  ShiftEnd     DateTime?

  User User @relation(fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Registrar {
  RegistrarID Int     @id @default(autoincrement())
  UserID      Int     @unique
  Schedule    String?

  User User @relation(fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Department {
  DepartmentID   Int    @id @default(autoincrement())
  DepartmentName String @unique

  Faculty Faculty[]
}

model Document {
  DocumentID       Int              @id @default(autoincrement())
  FacultyID        Int
  DocumentTypeID   Int
  UploadDate       DateTime         @default(now())
  SubmissionStatus SubmissionStatus

  Faculty      Faculty      @relation(fields: [FacultyID], references: [FacultyID])
  DocumentType DocumentType @relation(fields: [DocumentTypeID], references: [DocumentTypeID])
}

model DocumentType {
  DocumentTypeID   Int    @id @default(autoincrement())
  DocumentTypeName String @unique

  Document Document[]
}

model Contract {
  ContractID   Int          @id @default(autoincrement())
  StartDate    DateTime
  EndDate      DateTime
  ContractType ContractType

  Faculty Faculty[]
}

model Schedule {
  ScheduleID   Int       @id @default(autoincrement())
  FacultyID    Int
  DayOfWeek    DayOfWeek
  StartTime    DateTime
  EndTime      DateTime
  Subject      String
  ClassSection String

  Faculty Faculty @relation(fields: [FacultyID], references: [FacultyID])
}

model AIChat {
  ChatID   Int    @id @default(autoincrement())
  UserID   Int
  Question String
  Answer   String
  Status   String

  User User @relation(fields: [UserID], references: [UserID])
}

model Report {
  ReportID      Int      @id @default(autoincrement())
  GeneratedBy   Int
  ReportType    String
  GeneratedDate DateTime @default(now())
  Details       String

  User User @relation(fields: [GeneratedBy], references: [UserID])
}

model Notification {
  NotificationID Int      @id @default(autoincrement())
  UserID         Int
  Message        String
  DateSent       DateTime @default(now())
  Type           String
  IsRead         Boolean  @default(false)

  User User @relation(fields: [UserID], references: [UserID])
}

model ActivityLog {
  LogID          Int      @id @default(autoincrement())
  UserID         Int?
  ActionType     String
  EntityAffected String
  RecordID       Int?
  ActionDetails  String
  Timestamp      DateTime @default(now())
  IPAddress      String

  User User? @relation(fields: [UserID], references: [UserID], onDelete: SetNull)
}
