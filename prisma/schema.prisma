generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model UserIDSequence {
  id        Int @id @default(autoincrement())
  year      Int @unique
  lastCount Int
}

model User {
  UserID       String         @id
  ClerkID      String?        @unique
  EmployeeID   String?        @unique
  FirstName    String
  LastName     String
  Email        String         @unique
  Photo        String?
  PasswordHash String
  Status       Status         @default(Active)
  DateCreated  DateTime       @default(now())
  DateModified DateTime?      @updatedAt
  LastLogin    DateTime?
  createdBy    String?
  updatedBy    String?
  isDeleted    Boolean        @default(false)
  invitationId String?        @db.VarChar(255)
  AIChat       AIChat[]
  ActivityLog  ActivityLog[]
  Cashier      Cashier?       @relation("UserCashier")
  Faculty      Faculty?       @relation("UserFaculty")
  Notification Notification[]
  Registrar    Registrar?     @relation("UserRegistrar")
  Report       Report[]
  Employee     Employee?      @relation(fields: [EmployeeID], references: [EmployeeID])
  Role         UserRole[]
  trainingDocs  TrainingDocument[]

  @@index([invitationId], map: "user_invitation_id_idx")
}

model Faculty {
  FacultyID        Int              @id
  UserID           String           @unique
  EmployeeID       String?          @unique
  DateOfBirth      DateTime         @db.Date
  Phone            String?
  Address          String?
  EmploymentStatus EmploymentStatus @default(Regular)
  HireDate         DateTime         @db.Date
  ResignationDate  DateTime?        @db.Date
  Position         String
  DepartmentID     Int
  ContractID       Int?
  EmergencyContact String?
  EmployeeType     EmployeeType     @default(Regular)
  Attendance       Attendance[]
  Documents        Document[]
  Contract         Contract?        @relation(fields: [ContractID], references: [ContractID])
  Department       Department       @relation(fields: [DepartmentID], references: [DepartmentID])
  Employee         Employee?        @relation(fields: [EmployeeID], references: [EmployeeID])
  User             User             @relation("UserFaculty", fields: [UserID], references: [UserID])
  Leaves           Leave[]
  Schedules        Schedules[]
}

model Employee {
  EmployeeID        String              @id @unique
  UserID            String?             @unique
  LastName          String?
  FirstName         String?
  MiddleName        String?
  ExtensionName     String?
  Sex               String?
  Photo             String?
  DateOfBirth       DateTime            @db.Date
  PlaceOfBirth      String?
  CivilStatus       String?
  Nationality       String?
  Religion          String?
  BloodType         String?
  ContractID        Int?
  DepartmentID      Int?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime?           @updatedAt
  createdBy         String?
  updatedBy         String?
  Email             String?             @unique
  HireDate          DateTime            @default(now()) @db.Date
  Position          String?
  Attendance        Attendance[]
  contactInfo       ContactInfo?
  Documents         Document[]
  Education         Education[]
  Eligibility       Eligibility[]
  Contract          Contract?           @relation(fields: [ContractID], references: [ContractID])
  Department        Department?         @relation(fields: [DepartmentID], references: [DepartmentID])
  employmentDetails EmploymentDetail?
  EmploymentHistory EmploymentHistory[]
  PromotionHistory  PromotionHistory[]
  Faculty           Faculty?
  Family            Family[]
  governmentIds     GovernmentID?
  Leaves            Leave[]
  MedicalInfo       MedicalInfo?
  retirement        Retirement?
  User              User?
  certificates      Certificate[]
  skills            Skill[]
  trainings         trainings[]
}

model GovernmentID {
  id               Int       @id @default(autoincrement())
  employeeId       String    @unique
  SSSNumber        String?
  TINNumber        String?
  PhilHealthNumber String?
  PagIbigNumber    String?
  GSISNumber       String?
  PRCLicenseNumber String?
  PRCValidity      DateTime?
  BIRNumber        String?
  PassportNumber   String?
  PassportValidity DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  createdBy        String?
  updatedBy        String?
  employee         Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model EmploymentDetail {
  id               Int               @id @default(autoincrement())
  employeeId       String            @unique
  EmploymentStatus EmploymentStatus  @default(Regular)
  ResignationDate  DateTime?         @db.Date
  RetirementDate   DateTime?         @db.Date
  RetirementStatus RetirementStatus?
  Designation      Designation?
  Position         String?
  SalaryGrade      String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime?         @updatedAt
  createdBy        String?
  updatedBy        String?
  HireDate         DateTime?         @db.Date
  employee         Employee          @relation(fields: [employeeId], references: [EmployeeID])
}

model Retirement {
  id                Int                     @id @default(autoincrement())
  employeeId        String                  @unique
  requestDate       DateTime                @default(now())
  effectiveDate     DateTime                @db.Date
  pensionPlanType   String?
  pensionAmount     Float?
  clearanceStatus   Boolean                 @default(false)
  exitInterviewDate DateTime?
  remarks           String?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  createdBy         String?
  updatedBy         String?
  status            RetirementProcessStatus @default(Pending)
  documents         Document[]
  employee          Employee                @relation(fields: [employeeId], references: [EmployeeID])
}

model ContactInfo {
  id                     Int       @id @default(autoincrement())
  employeeId             String    @unique
  Phone                  String?
  PresentAddress         String?
  PermanentAddress       String?
  EmergencyContactName   String?
  EmergencyContactNumber String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime? @updatedAt
  createdBy              String?
  updatedBy              String?
  Email                  String?   @unique
  employee               Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model Cashier {
  CashierID    Int       @id @default(autoincrement())
  UserID       String    @unique
  WorkSchedule String?
  ShiftStart   DateTime?
  ShiftEnd     DateTime?
  User         User      @relation("UserCashier", fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Registrar {
  RegistrarID Int     @id @default(autoincrement())
  UserID      String  @unique
  Schedule    String?
  User        User    @relation("UserRegistrar", fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Department {
  DepartmentID   Int            @id @default(autoincrement())
  DepartmentName String         @unique
  type           DepartmentType @default(Default)
  Employees      Employee[]
  Faculty        Faculty[]
}

model Document {
  DocumentID       Int              @id @default(autoincrement())
  FacultyID        Int
  employeeId       String?
  DocumentTypeID   Int
  UploadDate       DateTime?        @default(now())
  SubmissionStatus SubmissionStatus @default(Submitted)
  FilePath         String?
  FileUrl          String?
  DownloadUrl      String?
  retirementId     Int?
  DocumentType     DocumentType     @relation(fields: [DocumentTypeID], references: [DocumentTypeID])
  Faculty          Faculty          @relation(fields: [FacultyID], references: [FacultyID])
  Employee         Employee?        @relation(fields: [employeeId], references: [EmployeeID])
  Retirement       Retirement?      @relation(fields: [retirementId], references: [id])

  @@index([FacultyID])
  @@index([DocumentTypeID])
}

model DocumentType {
  DocumentTypeID   Int        @id @default(autoincrement())
  DocumentTypeName String     @unique
  AllowedFileTypes String[]
  Template         String?
  Document         Document[]
}

model Contract {
  ContractID   Int          @id @default(autoincrement())
  StartDate    DateTime
  EndDate      DateTime
  ContractType ContractType
  Employees    Employee[]
  Faculty      Faculty[]
}

model Attendance {
  id         Int              @id @default(autoincrement())
  facultyId  Int
  employeeId String?
  date       DateTime         @default(now()) @db.Date
  timeIn     DateTime?        @db.Time(6)
  timeOut    DateTime?        @db.Time(6)
  remarks    String?
  createdAt  DateTime         @default(now())
  updatedAt  DateTime?        @updatedAt
  status     AttendanceStatus @default(NOT_RECORDED)
  Employee   Employee?        @relation(fields: [employeeId], references: [EmployeeID])
  Faculty    Faculty          @relation(fields: [facultyId], references: [FacultyID])
}

model Schedules {
  id             Int          @id @default(autoincrement())
  facultyId      Int
  subjectId      Int
  classSectionId Int
  day            String
  time           String
  duration       Int
  createdAt      DateTime     @default(now())
  updatedAt      DateTime?    @updatedAt
  classSection   ClassSection @relation(fields: [classSectionId], references: [id])
  faculty        Faculty      @relation(fields: [facultyId], references: [FacultyID])
  subject        Subject      @relation(fields: [subjectId], references: [id])
}

model AIChat {
  ChatID   Int    @id @default(autoincrement())
  UserID   String
  Question String
  Answer   String
  Status   String
  dateSubmitted DateTime @default(now())
  User     User   @relation(fields: [UserID], references: [UserID])
}

model ChatTopic {
  id        String      @id @default(cuid())
  userId    String
  title     String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  messages  ChatMessage[]
}

model ChatMessage {
  id        String   @id @default(cuid())
  topicId   String
  sender    String   // 'user' or 'bot'
  text      String
  timestamp DateTime @default(now())
  ChatTopic ChatTopic @relation(fields: [topicId], references: [id])
}

model TrainingDocument {
  id         String   @id @default(cuid())
  UserID   String
  title      String
  content    String
  fileUrl    String?
  fileType   String
  uploadedBy String
  uploadedAt DateTime @default(now())
  status     Status   @default(Active)
  User     User   @relation(fields: [UserID], references: [UserID])
}

model Report {
  ReportID      Int      @id @default(autoincrement())
  GeneratedBy   String
  ReportType    String
  GeneratedDate DateTime @default(now())
  Details       String
  User          User     @relation(fields: [GeneratedBy], references: [UserID])
}

model Notification {
  NotificationID Int      @id @default(autoincrement())
  UserID         String
  Message        String
  DateSent       DateTime @default(now())
  Type           String
  IsRead         Boolean  @default(false)
  User           User     @relation(fields: [UserID], references: [UserID])
}

model ActivityLog {
  LogID          Int      @id @default(autoincrement())
  UserID         String?
  ActionType     String?
  EntityAffected String?
  RecordID       Int?
  ActionDetails  String
  Timestamp      DateTime @default(now())
  IPAddress      String?
  User           User?    @relation(fields: [UserID], references: [UserID])
}

model Role {
  id    Int        @id @default(autoincrement())
  name  String     @unique
  users UserRole[]
}

model UserRole {
  userId String
  roleId Int
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [UserID], onDelete: Cascade)

  @@id([userId, roleId])
}

model Leave {
  LeaveID                 Int         @id @default(autoincrement())
  FacultyID               Int
  employeeId              String?
  RequestType             RequestType @default(Leave)
  LeaveType               LeaveType?
  StartDate               DateTime?
  EndDate                 DateTime?
  TimeIn                  DateTime?
  TimeOut                 DateTime?
  Reason                  String
  Status                  LeaveStatus @default(Pending)
  EmploymentType          String?
  employeeSignature       String?
  departmentHeadSignature String?
  CreatedAt               DateTime    @default(now())
  UpdatedAt               DateTime?   @updatedAt
  Faculty                 Faculty     @relation(fields: [FacultyID], references: [FacultyID])
  Employee                Employee?   @relation(fields: [employeeId], references: [EmployeeID])
}

model Vacancy {
  VacancyID         Int           @id @default(autoincrement())
  JobTitle          JobTitle
  VacancyName       String
  Description       String?
  HiringManager     String
  Status            VacancyStatus @default(Active)
  DatePosted        DateTime?
  DateCreated       DateTime      @default(now())
  DateModified      DateTime?     @updatedAt
  isDeleted         Boolean       @default(false)
  createdBy         String?
  updatedBy         String?
  NumberOfPositions Int           @default(1)
  Candidates        Candidate[]
}

model Candidate {
  CandidateID   Int             @id @default(autoincrement())
  VacancyID     Int
  LastName      String
  FirstName     String
  MiddleName    String?
  ExtensionName String?
  FullName      String
  Email         String
  ContactNumber String?
  Sex           Sex?
  DateOfBirth   DateTime?       @db.Date
  Phone         String?
  DateApplied   DateTime        @default(now())
  InterviewDate DateTime?
  Status        CandidateStatus @default(ApplicationInitiated)
  Resume        String?
  ResumeUrl     String?
  isDeleted     Boolean         @default(false)
  DateCreated   DateTime        @default(now())
  DateModified  DateTime?       @updatedAt
  createdBy     String?
  updatedBy     String?
  Vacancy       Vacancy         @relation(fields: [VacancyID], references: [VacancyID])

  @@index([VacancyID])
}

model Subject {
  id        Int         @id @default(autoincrement())
  name      String      @unique
  schedules Schedules[]
}

model ClassSection {
  id        Int         @id @default(autoincrement())
  name      String      @unique
  schedules Schedules[]
}

model Education {
  id            Int      @id @default(autoincrement())
  employeeId    String
  level         String
  schoolName    String
  course        String?
  yearGraduated Int?
  honors        String?
  employee      Employee @relation(fields: [employeeId], references: [EmployeeID])
}

model EmploymentHistory {
  id               Int       @id @default(autoincrement())
  employeeId       String
  schoolName       String
  position         String
  startDate        DateTime
  endDate          DateTime?
  reasonForLeaving String?
  employee         Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model PromotionHistory {
  id           Int       @id @default(autoincrement())
  employeeId   String
  fromPosition String?
  toPosition   String
  fromSalaryGrade String?
  toSalaryGrade   String?
  effectiveDate   DateTime
  promotionType   String?  // "Promotion", "Transfer", "Salary Adjustment", etc.
  remarks         String?
  approvedBy      String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime? @updatedAt
  createdBy       String?
  updatedBy       String?
  employee        Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model Skill {
  id                Int       @id @default(autoincrement())
  employeeId        String
  name              String
  proficiencyLevel  String
  yearsOfExperience Int
  description       String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime? @updatedAt
  employee          Employee  @relation(fields: [employeeId], references: [EmployeeID])

  @@map("skills")
}

model MedicalInfo {
  id                        Int       @id @default(autoincrement())
  employeeId                String    @unique
  medicalNotes              String?
  lastCheckup               DateTime?
  vaccination               String?
  allergies                 String?
  hasDisability             Boolean   @default(false)
  disabilityType            String?
  disabilityDetails         String?
  accommodationsNeeded      String?
  pwdIdNumber               String?
  pwdIdValidity             DateTime?
  disabilityCertification   String?
  disabilityPercentage      Int?
  assistiveTechnology       String?
  mobilityAids              String?
  communicationNeeds        String?
  workplaceModifications    String?
  emergencyProtocol         String?
  bloodPressure             String?
  height                    Float?
  weight                    Float?
  emergencyProcedures       String?
  primaryPhysician          String?
  physicianContact          String?
  healthInsuranceProvider   String?
  healthInsuranceNumber     String?
  healthInsuranceExpiryDate DateTime?
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime? @updatedAt
  createdBy                 String?
  updatedBy                 String?
  employee                  Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model Family {
  id            Int       @id @default(autoincrement())
  employeeId    String
  type          String
  name          String
  dateOfBirth   DateTime?
  occupation    String?
  isDependent   Boolean   @default(false)
  relationship  String?
  contactNumber String?
  address       String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime? @updatedAt
  employee      Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model Certificate {
  id          Int       @id @default(autoincrement())
  employeeId  String
  title       String
  issuedBy    String
  issueDate   DateTime
  expiryDate  DateTime?
  description String?
  fileUrl     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  employee    Employee  @relation(fields: [employeeId], references: [EmployeeID])

  @@map("certificates")
}

model Eligibility {
  id            Int       @id @default(autoincrement())
  employeeId    String
  type          String
  rating        Float?
  licenseNumber String?
  examDate      DateTime?
  validUntil    DateTime?
  Employee      Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model WebhookPending {
  id           Int       @id @default(autoincrement())
  type         String    @db.VarChar(50)
  invitationId String    @db.VarChar(255)
  userId       String    @db.VarChar(255)
  email        String    @db.VarChar(255)
  createdAt    DateTime  @default(now()) @db.Timestamp(6)
  processedAt  DateTime? @db.Timestamp(6)
  status       String?   @default("pending") @db.VarChar(50)
  error        String?

  @@index([invitationId], map: "webhook_pending_invitation_id_idx")
  @@index([status], map: "webhook_pending_status_idx")
  @@index([userId], map: "webhook_pending_user_id_idx")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model trainings {
  id          Int       @id @default(autoincrement())
  employeeId  String
  title       String
  hours       Int
  conductedBy String
  date        DateTime
  createdAt   DateTime  @default(now())
  updatedAt   DateTime?
  Employee    Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

enum DepartmentType {
  Pre_School
  Primary
  Intermediate
  JHS
  Admin
  Default
}

enum Status {
  Invited
  Active
  Inactive
}

enum EmploymentStatus {
  Hired
  Resigned
  Regular
  Probationary
  Part_Time
  Retired
}

enum EmployeeType {
  Regular
  Probationary
  Part_Time
  Retired
  Resigned
}

enum SubmissionStatus {
  Submitted
  Pending
  Approved
  Rejected
}

enum ContractType {
  Full_Time
  Part_Time
  Probationary
}

enum DayOfWeek {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  NOT_RECORDED
}

enum LeaveStatus {
  Pending
  Approved
  Rejected
}

enum LeaveType {
  Sick
  Vacation
  Emergency
  Undertime
  Maternity
  Paternity
}

enum RequestType {
  Leave
  Undertime
}

enum JobTitle {
  HR_Manager
  Faculty
  Registrar
  Cashier
  Other
}

enum VacancyStatus {
  Active
  Inactive
  Filled
  Cancelled
  Withdrawn
}

enum CandidateStatus {
  ApplicationInitiated
  UnderReview
  Shortlisted
  InterviewScheduled
  InterviewCompleted
  Offered
  Hired
  Rejected
  Withdrawn
}

enum Designation {
  President
  Admin_Officer
  Vice_President
  Registrar
  Faculty
  Principal
  Cashier
}

enum Role2 {
  APPLICANT
  EMPLOYEE
  ADMIN
}

enum Sex {
  Male
  Female
  Intersex
}

enum EmploymentType {
  FullTime
  Part_Time
}

enum RetirementStatus {
  NotEligible
  Approaching
  Eligible
  Processing
  Retired
}

enum RetirementProcessStatus {
  Pending
  DocumentsSubmitted
  ClearanceInProgress
  ExitInterviewScheduled
  ExitInterviewCompleted
  BenefitsProcessing
  Completed
  Cancelled
}

enum LeaveAccrualPeriod {
  MONTHLY
  YEARLY
  ONE_TIME
}
