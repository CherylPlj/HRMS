generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model UserIDSequence {
  id        Int @id @default(autoincrement())
  year      Int @unique
  lastCount Int
}

model User {
  UserID       String         @id
  ClerkID      String?        @unique
  EmployeeID   String?        @unique
  FirstName    String
  LastName     String
  Email        String         @unique
  Photo        String?
  PasswordHash String
  Status       Status         @default(Active)
  DateCreated  DateTime       @default(now())
  DateModified DateTime?      @updatedAt
  LastLogin    DateTime?
  createdBy String?
  updatedBy String?
  isDeleted Boolean @default(false)
  AIChat       AIChat[]
  ActivityLog  ActivityLog[]
  Cashier      Cashier?       @relation("UserCashier")
  Faculty      Faculty?       @relation("UserFaculty")
  Employee     Employee? @relation(fields: [EmployeeID], references: [EmployeeID])
  Notification Notification[]
  Registrar    Registrar?     @relation("UserRegistrar")
  Report       Report[]
  Role         UserRole[]
}

model Faculty {
  FacultyID        Int              @id
  UserID           String           @unique
  EmployeeID       String?           @unique
  DateOfBirth      DateTime         @db.Date
  Phone            String?
  Address          String?
  EmploymentStatus EmploymentStatus @default(Regular)
  HireDate         DateTime         @db.Date
  ResignationDate  DateTime?        @db.Date
  Position         String
  DepartmentID     Int
  ContractID       Int?
  EmergencyContact String?
  EmployeeType     EmployeeType     @default(Regular)
  Attendance       Attendance[]
  Documents        Document[]
  Contract         Contract?        @relation(fields: [ContractID], references: [ContractID])
  Department       Department       @relation(fields: [DepartmentID], references: [DepartmentID])
  User             User             @relation("UserFaculty", fields: [UserID], references: [UserID], onDelete: Restrict)
  Employee    Employee? @relation(fields: [EmployeeID], references: [EmployeeID])
  Leaves           Leave[]
  Schedules        Schedules[]
}

model Employee {
  EmployeeID       String           @id @unique
  UserID           String?          @unique
  FacultyID        Int?
  LastName         String?
  FirstName        String?
  MiddleName       String?
  ExtensionName    String?          // Jr., Sr., III, etc.
  Sex              String?
  Photo            String?          // URL or path to employee's photo
  DateOfBirth      DateTime         @db.Date
  PlaceOfBirth     String?
  CivilStatus      String?
  Nationality      String?
  Religion         String?
  BloodType        String?
  Email            String?          @unique
  Phone            String?
  Address          String?
  PresentAddress   String?
  PermanentAddress String?

  // Government IDs
  SSSNumber        String?
  TINNumber        String?
  PhilHealthNumber String?
  PagIbigNumber    String?
  GSISNumber       String?
  PRCLicenseNumber String?
  PRCValidity      DateTime?

  EmploymentStatus EmploymentStatus @default(Regular)
  HireDate         DateTime         @db.Date
  ResignationDate  DateTime?        @db.Date
  Designation      Designation?
  Position         String?
  DepartmentID     Int?
  ContractID       Int?
  EmergencyContactName   String?
  EmergencyContactNumber String?
  EmployeeType     EmployeeType?    @default(Regular)
  SalaryGrade      String?

  // Relations
  Attendance       Attendance[]
  Documents        Document[]
  Contract         Contract?        @relation(fields: [ContractID], references: [ContractID])
  Department       Department?      @relation(fields: [DepartmentID], references: [DepartmentID])
  User             User?
  Faculty          Faculty?
  Leaves           Leave[]
  Education        Education[]
  Eligibility      Eligibility[]
  EmploymentHistory EmploymentHistory[]
  Training         Training[]
  MedicalInfo      MedicalInfo?
  Family           Family[]
  skills           Skill[]
  certificates     Certificate[]

  createdAt        DateTime @default(now())
  updatedAt        DateTime? @updatedAt
}

model Cashier {
  CashierID    Int       @id @default(autoincrement())
  UserID       String    @unique
  WorkSchedule String?
  ShiftStart   DateTime?
  ShiftEnd     DateTime?
  User         User      @relation("UserCashier", fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Registrar {
  RegistrarID Int     @id @default(autoincrement())
  UserID      String  @unique
  Schedule    String?
  User        User    @relation("UserRegistrar", fields: [UserID], references: [UserID], onDelete: Cascade)
}

enum DepartmentType {
  Pre_School
  Primary
  Intermediate
  JHS
  Admin
  Default
}

model Department {
  DepartmentID   Int       @id @default(autoincrement())
  DepartmentName String    @unique
  type          DepartmentType  @default(Default)
  Faculty        Faculty[]
  Employees      Employee[]
}

model Document {
  DocumentID        Int       @id @default(autoincrement())
  FacultyID         Int
  employeeId        String?   // <-- add this line
  DocumentTypeID    Int
  UploadDate        DateTime?  @default(now())
  SubmissionStatus  SubmissionStatus @default(Submitted)
  FilePath          String?   // Google Drive file ID
  FileUrl           String?   // Google Drive web view link
  DownloadUrl       String?   // Google Drive download link
  Faculty           Faculty   @relation(fields: [FacultyID], references: [FacultyID])
  Employee          Employee? @relation(fields: [employeeId], references: [EmployeeID]) // <-- add this
  DocumentType      DocumentType @relation(fields: [DocumentTypeID], references: [DocumentTypeID])

  @@index([FacultyID])
  @@index([DocumentTypeID])
}

model DocumentType {
  DocumentTypeID   Int        @id @default(autoincrement())
  DocumentTypeName String     @unique
  AllowedFileTypes String[]   // Array of allowed file extensions
  Template        String?     // Optional template file path
  Document        Document[]
}

model Contract {
  ContractID   Int          @id @default(autoincrement())
  StartDate    DateTime
  EndDate      DateTime
  ContractType ContractType
  Faculty      Faculty[]
  Employees    Employee[]   // <-- add this
}

model Attendance {
  id         Int       @id @default(autoincrement())
  facultyId  Int
  employeeId        String?   // <-- add this line
  date       DateTime  @default(now())  @db.Date
  timeIn     DateTime?    @db.Time
  timeOut    DateTime?   @db.Time
  remarks    String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime?  @updatedAt
  status     AttendanceStatus @default(NOT_RECORDED)
  Faculty    Faculty   @relation(fields: [facultyId], references: [FacultyID])
  Employee   Employee? @relation(fields: [employeeId], references: [EmployeeID]) // <-- add this

}

model Schedules {
  id             Int          @id @default(autoincrement())
  facultyId      Int
  subjectId      Int
  classSectionId Int
  day            String
  time           String
  duration       Int
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  faculty      Faculty      @relation(fields: [facultyId], references: [FacultyID])
  subject      Subject      @relation(fields: [subjectId], references: [id])
  classSection ClassSection @relation(fields: [classSectionId], references: [id])
}

model AIChat {
  ChatID   Int    @id @default(autoincrement())
  UserID   String
  Question String
  Answer   String
  Status   String
  User     User   @relation(fields: [UserID], references: [UserID])
}

model Report {
  ReportID      Int      @id @default(autoincrement())
  GeneratedBy   String
  ReportType    String
  GeneratedDate DateTime @default(now())
  Details       String
  User          User     @relation(fields: [GeneratedBy], references: [UserID])
}

model Notification {
  NotificationID Int      @id @default(autoincrement())
  UserID         String
  Message        String
  DateSent       DateTime @default(now())
  Type           String
  IsRead         Boolean  @default(false)
  User           User     @relation(fields: [UserID], references: [UserID])
}

model ActivityLog {
  LogID          Int      @id @default(autoincrement())
  UserID         String?
  ActionType     String?
  EntityAffected String?
  RecordID       Int?
  ActionDetails  String
  Timestamp      DateTime @default(now())
  IPAddress      String?
  User           User?    @relation(fields: [UserID], references: [UserID])
}

model Role {
  id    Int        @id @default(autoincrement())
  name  String     @unique
  users UserRole[]
}

model UserRole {
  userId String
  roleId Int
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [UserID], onDelete: Cascade)

  @@id([userId, roleId])
}

model Leave {
  LeaveID                 Int         @id @default(autoincrement())
  FacultyID               Int
  employeeId        String?   // <-- add this line
  RequestType             RequestType @default(Leave)
  LeaveType               LeaveType?
  StartDate               DateTime?
  EndDate                 DateTime?
  TimeIn                  DateTime?
  TimeOut                 DateTime?
  Reason                  String
  Status                  LeaveStatus @default(Pending)
  EmploymentType          String?
  employeeSignature       String?
  departmentHeadSignature String?
  CreatedAt              DateTime    @default(now())
  UpdatedAt              DateTime    @updatedAt
  Faculty                Faculty     @relation(fields: [FacultyID], references: [FacultyID])
  Employee                Employee?   @relation(fields: [employeeId], references: [EmployeeID]) // <-- add this
}

model Vacancy {
  VacancyID      Int       @id @default(autoincrement())
  JobTitle       JobTitle
  VacancyName    String
  Description    String?
  HiringManager  String
  Status         VacancyStatus @default(Active)
  DatePosted     DateTime?
  DateCreated    DateTime  @default(now())
  DateModified   DateTime  @updatedAt
  isDeleted      Boolean   @default(false)
  createdBy      String?
  updatedBy      String?
  NumberOfPositions Int    @default(1)
  Candidates     Candidate[]
}

model Candidate {
  CandidateID    Int       @id @default(autoincrement())
  VacancyID      Int
  LastName       String
  FirstName      String
  MiddleName     String?
  ExtensionName  String?
  FullName       String    // Computed field for backward compatibility
  Email          String
  ContactNumber  String?
  Sex            Sex?
  DateOfBirth    DateTime? @db.Date
  Phone          String?   // Keeping for backward compatibility
  DateApplied    DateTime  @default(now())
  InterviewDate  DateTime?
  Status         CandidateStatus @default(ApplicationInitiated)
  Resume         String?   // Google Drive file ID
  ResumeUrl      String?   // Google Drive web view link
  isDeleted      Boolean   @default(false)
  DateCreated    DateTime  @default(now())
  DateModified   DateTime?  @updatedAt
  createdBy      String?
  updatedBy      String?
  Vacancy        Vacancy   @relation(fields: [VacancyID], references: [VacancyID])

  @@index([VacancyID])
}

enum Status {
  Invited
  Active
  Inactive
}

enum EmploymentStatus {
  Hired
  Resigned
  Regular
  Probationary
}

enum EmployeeType {
  Regular
  Probationary
  Resigned
}

enum SubmissionStatus {
  Submitted
  Pending
  Approved
  Rejected
}

enum ContractType {
  Full_Time
  Part_Time
  Probationary
}

enum DayOfWeek {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  NOT_RECORDED
}

enum LeaveStatus {
  Pending
  Approved
  Rejected
}

enum LeaveType {
  Sick
  Vacation
  Emergency
  Undertime
  Maternity
}

enum RequestType {
  Leave
  Undertime
}

model Subject {
  id        Int         @id @default(autoincrement())
  name      String      @unique
  schedules Schedules[]
}

model ClassSection {
  id        Int         @id @default(autoincrement())
  name      String      @unique
  schedules Schedules[]
}

enum JobTitle {
  HR_Manager
  Faculty
  Registrar
  Cashier
  Other
}

enum VacancyStatus {
  Active
  Inactive
  Filled
  Cancelled
  Withdrawn
}

enum CandidateStatus {
  ApplicationInitiated
  UnderReview
  Shortlisted
  InterviewScheduled
  InterviewCompleted
  Offered
  Hired
  Rejected
  Withdrawn
}

enum Designation {
  President
  Admin_Officer
  Vice_President
  Registrar
  Faculty
  Principal
  Cashier
}

enum Role2 {
  APPLICANT
  EMPLOYEE
  ADMIN
}

enum Sex {
  Male
  Female
  Intersex
}

enum EmploymentType {
  FullTime
}

model Education {
  id         Int      @id @default(autoincrement())
  employee   Employee @relation(fields: [employeeId], references: [EmployeeID])
  employeeId String
  level      String   // Elementary, High School, College, etc.
  schoolName String
  course     String?
  yearGraduated Int?
  honors     String?
}

model Eligibility {
  id         Int      @id @default(autoincrement())
  employee   Employee @relation(fields: [employeeId], references: [EmployeeID])
  employeeId String
  type       String   // e.g., LET, Civil Service
  rating     Float?
  licenseNumber String?
  examDate   DateTime?
  validUntil DateTime?
}

model EmploymentHistory {
  id         Int      @id @default(autoincrement())
  employee   Employee @relation(fields: [employeeId], references: [EmployeeID])
  employeeId String
  schoolName String
  position   String
  startDate  DateTime
  endDate    DateTime?
  reasonForLeaving String?
}

model Training {
  id          Int      @id @default(autoincrement())
  employeeId  String
  title       String
  hours       Int
  conductedBy String
  date        DateTime
  employee    Employee @relation(fields: [employeeId], references: [EmployeeID])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("trainings")
}

model Skill {
  id                Int      @id @default(autoincrement())
  employeeId        String
  name              String
  proficiencyLevel  String
  yearsOfExperience Int
  description       String?
  employee          Employee @relation(fields: [employeeId], references: [EmployeeID])
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("skills")
}

model MedicalInfo {
  id             Int      @id @default(autoincrement())
  employee       Employee @relation(fields: [employeeId], references: [EmployeeID])
  employeeId     String   @unique
  medicalNotes   String?
  lastCheckup    DateTime?
  vaccination    String?
  allergies      String?
}

model Family {
  id         Int      @id @default(autoincrement())
  employee   Employee @relation(fields: [employeeId], references: [EmployeeID])
  employeeId String
  type       String   // Spouse, Child, Parent, etc.
  name       String
  dateOfBirth DateTime?
  occupation String?
  isDependent Boolean @default(false)
  relationship String?
  contactNumber String?
  address     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime? @updatedAt
}

model Certificate {
  id          Int      @id @default(autoincrement())
  employeeId  String
  title       String
  issuedBy    String
  issueDate   DateTime
  expiryDate  DateTime?
  description String?
  fileUrl     String?
  employee    Employee @relation(fields: [employeeId], references: [EmployeeID])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("certificates")
}
