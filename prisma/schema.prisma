generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model UserIDSequence {
  id        Int @id @default(autoincrement())
  year      Int @unique
  lastCount Int
}

model User {
  UserID       String         @id
  FirstName    String
  LastName     String
  Email        String         @unique
  Photo        String?
  PasswordHash String
  Status       Status         @default(Active)
  DateCreated  DateTime       @default(now())
  DateModified DateTime?      @updatedAt
  LastLogin    DateTime?
  createdBy    String?
  isDeleted    Boolean        @default(false)
  updatedBy    String?
  ClerkID      String?        @unique
  AIChat       AIChat[]
  ActivityLog  ActivityLog[]
  Cashier      Cashier?       @relation("UserCashier")
  Faculty      Faculty?       @relation("UserFaculty")
  Notification Notification[]
  Registrar    Registrar?     @relation("UserRegistrar")
  Report       Report[]
  Role         UserRole[]
}

model Faculty {
  FacultyID        Int              @id
  UserID           String           @unique
  DateOfBirth      DateTime         @db.Date
  Phone            String?
  Address          String?
  EmploymentStatus EmploymentStatus @default(Regular)
  HireDate         DateTime         @db.Date
  ResignationDate  DateTime?        @db.Date
  Position         String
  DepartmentID     Int
  ContractID       Int?
  EmergencyContact String?
  EmployeeType     EmployeeType     @default(Regular)
  Attendance       Attendance[]
  Documents        Document[]
  Contract         Contract?        @relation(fields: [ContractID], references: [ContractID])
  Department       Department       @relation(fields: [DepartmentID], references: [DepartmentID])
  User             User             @relation("UserFaculty", fields: [UserID], references: [UserID])
  Leaves           Leave[]
  Schedules        Schedule[]
}

model Cashier {
  CashierID    Int       @id @default(autoincrement())
  UserID       String    @unique
  WorkSchedule String?
  ShiftStart   DateTime?
  ShiftEnd     DateTime?
  User         User      @relation("UserCashier", fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Registrar {
  RegistrarID Int     @id @default(autoincrement())
  UserID      String  @unique
  Schedule    String?
  User        User    @relation("UserRegistrar", fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Department {
  DepartmentID   Int       @id @default(autoincrement())
  DepartmentName String    @unique
  Faculty        Faculty[]
}

model Document {
  DocumentID       Int              @id @default(autoincrement())
  FacultyID        Int
  DocumentTypeID   Int
  UploadDate       DateTime?        @default(now())
  SubmissionStatus SubmissionStatus @default(Submitted)
  FileUrl          String?
  DownloadUrl      String?
  FilePath         String?
  DocumentType     DocumentType     @relation(fields: [DocumentTypeID], references: [DocumentTypeID])
  Faculty          Faculty          @relation(fields: [FacultyID], references: [FacultyID])

  @@index([FacultyID])
  @@index([DocumentTypeID])
}

model DocumentType {
  DocumentTypeID   Int        @id @default(autoincrement())
  DocumentTypeName String     @unique
  AllowedFileTypes String[]
  Template         String?
  Document         Document[]
}

model Contract {
  ContractID   Int          @id @default(autoincrement())
  StartDate    DateTime
  EndDate      DateTime
  ContractType ContractType
  Faculty      Faculty[]
}

model Attendance {
  id        Int              @id @default(autoincrement())
  date      DateTime         @default(now()) @db.Date
  timeIn    DateTime?        @db.Time(6)
  timeOut   DateTime?        @db.Time(6)
  createdAt DateTime         @default(now())
  updatedAt DateTime?        @updatedAt
  facultyId Int
  status    AttendanceStatus @default(NOT_RECORDED)
  remarks   String?
  Faculty   Faculty          @relation(fields: [facultyId], references: [FacultyID])
}

model Schedule {
  ScheduleID   Int       @id @default(autoincrement())
  FacultyID    Int
  StartTime    DateTime
  EndTime      DateTime
  Subject      String
  ClassSection String
  DayOfWeek    DayOfWeek
  Faculty      Faculty   @relation(fields: [FacultyID], references: [FacultyID])
}

model AIChat {
  ChatID   Int    @id @default(autoincrement())
  UserID   String
  Question String
  Answer   String
  Status   String
  User     User   @relation(fields: [UserID], references: [UserID])
}

model Report {
  ReportID      Int      @id @default(autoincrement())
  GeneratedBy   String
  ReportType    String
  GeneratedDate DateTime @default(now())
  Details       String
  User          User     @relation(fields: [GeneratedBy], references: [UserID])
}

model Notification {
  NotificationID Int      @id @default(autoincrement())
  UserID         String
  Message        String
  DateSent       DateTime @default(now())
  Type           String
  IsRead         Boolean  @default(false)
  User           User     @relation(fields: [UserID], references: [UserID])
}

model ActivityLog {
  LogID          Int      @id @default(autoincrement())
  UserID         String?
  ActionType     String?
  EntityAffected String?
  RecordID       Int?
  ActionDetails  String
  Timestamp      DateTime @default(now())
  IPAddress      String?
  User           User?    @relation(fields: [UserID], references: [UserID])
}

model Role {
  id    Int        @id @default(autoincrement())
  name  String     @unique
  users UserRole[]
}

model UserRole {
  userId String
  roleId Int
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [UserID], onDelete: Cascade)

  @@id([userId, roleId])
}

model Leave {
  LeaveID                 Int         @id @default(autoincrement())
  FacultyID               Int
  LeaveType               LeaveType?
  StartDate               DateTime?
  EndDate                 DateTime?
  TimeIn                  DateTime?
  TimeOut                 DateTime?
  Reason                  String
  Status                  LeaveStatus @default(Pending)
  EmploymentType          String?
  employeeSignature       String?
  departmentHeadSignature String?
  CreatedAt              DateTime    @default(now())
  UpdatedAt              DateTime    @updatedAt
  Faculty                Faculty     @relation(fields: [FacultyID], references: [FacultyID])
  requestType            String      @default("Leave")

  @@index([FacultyID])
}

enum Status {
  Active
  Inactive
  Invited
}

enum EmploymentStatus {
  Hired
  Resigned
  Regular
  Probationary
}

enum SubmissionStatus {
  Submitted
  Pending
  Approved
  Rejected
}

enum ContractType {
  Full_Time
  Part_Time
  Probationary
}

enum DayOfWeek {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  NOT_RECORDED
}

enum LeaveStatus {
  Pending
  Approved
  Rejected
}

enum EmployeeType {
  Regular
  Under_Probation
}

enum LeaveType {
  Sick
  Vacation
  Emergency
}
