generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model UserIDSequence {
  id        Int @id @default(autoincrement())
  year      Int @unique
  lastCount Int
}

model User {
  UserID       String         @id
  ClerkID      String?        @unique
  EmployeeID   String?        @unique
  FirstName    String
  LastName     String
  Email        String         @unique
  Photo        String?
  PasswordHash String
  Status       Status         @default(Active)
  DateCreated  DateTime       @default(now())
  DateModified DateTime?      @updatedAt
  LastLogin    DateTime?
  createdBy    String?
  updatedBy    String?
  isDeleted    Boolean        @default(false)
  invitationId String?        @db.VarChar(255)
  AIChat       AIChat[]
  ActivityLog  ActivityLog[]
  Cashier      Cashier?       @relation("UserCashier")
  Faculty      Faculty?       @relation("UserFaculty")
  Notification Notification[]
  Registrar    Registrar?     @relation("UserRegistrar")
  Report       Report[]
  Employee     Employee?      @relation(fields: [EmployeeID], references: [EmployeeID])
  Role         UserRole[]
  trainingDocs  TrainingDocument[]
  PerformanceReviewer PerformanceReview[] @relation("PerformanceReviewer")
  DisciplinarySupervisor DisciplinaryRecord[] @relation("DisciplinarySupervisor")
  PIPInitiator PerformanceImprovementPlan[] @relation("PIPInitiator")
  PIPReviewer PIPReview[] @relation("PIPReviewer")
  DisciplinaryActionApprover DisciplinaryAction[] @relation("DisciplinaryActionApprover")
  AppealReviewer DisciplinaryAppeal[] @relation("AppealReviewer")

  @@index([invitationId], map: "user_invitation_id_idx")
}

model Faculty {
  FacultyID        Int              @id
  UserID           String           @unique
  EmployeeID       String?          @unique
  DateOfBirth      DateTime         @db.Date
  Phone            String?
  Address          String?
  EmploymentStatus EmploymentStatus @default(Regular)
  HireDate         DateTime         @db.Date
  ResignationDate  DateTime?        @db.Date
  Position         String
  DepartmentID     Int
  ContractID       Int?
  EmergencyContact String?
  EmployeeType     EmployeeType     @default(Regular)
  Attendance       Attendance[]
  Documents        Document[]
  Contract         Contract?        @relation(fields: [ContractID], references: [ContractID])
  Department       Department       @relation(fields: [DepartmentID], references: [DepartmentID])
  Employee         Employee?        @relation(fields: [EmployeeID], references: [EmployeeID])
  User             User             @relation("UserFaculty", fields: [UserID], references: [UserID])
  Leaves           Leave[]
  Schedules        Schedules[]
  isDeleted    Boolean        @default(false)
}

model Employee {
  EmployeeID        String              @id @unique
  UserID            String?             @unique
  LastName          String?
  FirstName         String?
  MiddleName        String?
  ExtensionName     String?
  Sex               String?
  Photo             String?
  DateOfBirth       DateTime            @db.Date
  PlaceOfBirth      String?
  CivilStatus       String?
  Nationality       String?
  Religion          String?
  BloodType         String?
  ContractID        Int?
  DepartmentID      Int?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime?           @updatedAt
  createdBy         String?
  updatedBy         String?
  Email             String?             @unique
  HireDate          DateTime            @default(now()) @db.Date
  Position          String?
  Attendance        Attendance[]
  contactInfo       ContactInfo?
  Documents         Document[]
  Education         Education[]
  Eligibility       Eligibility[]
  Contract          Contract?           @relation(fields: [ContractID], references: [ContractID])
  Department        Department?         @relation(fields: [DepartmentID], references: [DepartmentID])
  employmentDetails EmploymentDetail?
  EmploymentHistory EmploymentHistory[]
  PromotionHistory  PromotionHistory[]
  Faculty           Faculty?
  Family            Family[]
  governmentIds     GovernmentID?
  Leaves            Leave[]
  MedicalInfo       MedicalInfo?
  retirement        Retirement?
  User              User?
  certificates      Certificate[]
  skills            Skill[]
  trainings         trainings[]
  PerformanceReviews PerformanceReview[]
  DisciplinaryRecords DisciplinaryRecord[]
  PerformanceGoals PerformanceGoal[]
  PerformanceImprovementPlans PerformanceImprovementPlan[]
  PerformanceMetrics PerformanceMetric[]
  DisciplinaryAppeals DisciplinaryAppeal[]
  performanceModule      PerformanceModule?
  trainingNeedsAnalysis TrainingNeedsAnalysis[]
  disciplinaryRiskAnalysis DisciplinaryRiskAnalysis[]
  isDeleted    Boolean        @default(false)
}

model GovernmentID {
  id               Int       @id @default(autoincrement())
  employeeId       String    @unique
  SSSNumber        String?
  TINNumber        String?
  PhilHealthNumber String?
  PagIbigNumber    String?
  GSISNumber       String?
  PRCLicenseNumber String?
  PRCValidity      DateTime?
  BIRNumber        String?
  PassportNumber   String?
  PassportValidity DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  createdBy        String?
  updatedBy        String?
  employee         Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model EmploymentDetail {
  id               Int               @id @default(autoincrement())
  employeeId       String            @unique
  EmploymentStatus EmploymentStatus  @default(Regular)
  ResignationDate  DateTime?         @db.Date
  RetirementDate   DateTime?         @db.Date
  RetirementStatus RetirementStatus?
  Designation      Designation?
  Position         String?
  SalaryGrade      String?
  SalaryAmount     Decimal?          @db.Decimal(10, 2)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime?         @updatedAt
  createdBy        String?
  updatedBy        String?
  HireDate         DateTime?         @db.Date
  employee         Employee          @relation(fields: [employeeId], references: [EmployeeID])
}

model Retirement {
  id                Int                     @id @default(autoincrement())
  employeeId        String                  @unique
  requestDate       DateTime                @default(now())
  effectiveDate     DateTime                @db.Date
  pensionPlanType   String?
  pensionAmount     Float?
  clearanceStatus   Boolean                 @default(false)
  exitInterviewDate DateTime?
  remarks           String?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  createdBy         String?
  updatedBy         String?
  status            RetirementProcessStatus @default(Pending)
  documents         Document[]
  employee          Employee                @relation(fields: [employeeId], references: [EmployeeID])
}

model ContactInfo {
  id                     Int       @id @default(autoincrement())
  employeeId             String    @unique
  Phone                  String?
  MessengerName          String?
  FBLink                 String?
  PresentAddress         String?
  PermanentAddress       String?
  EmergencyContactName   String?
  EmergencyContactNumber String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime? @updatedAt
  createdBy              String?
  updatedBy              String?
  Email                  String?   @unique
  employee               Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model Cashier {
  CashierID    Int       @id @default(autoincrement())
  UserID       String    @unique
  WorkSchedule String?
  ShiftStart   DateTime?
  ShiftEnd     DateTime?
  User         User      @relation("UserCashier", fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Registrar {
  RegistrarID Int     @id @default(autoincrement())
  UserID      String  @unique
  Schedule    String?
  User        User    @relation("UserRegistrar", fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Department {
  DepartmentID   Int            @id @default(autoincrement())
  DepartmentName String         @unique
  type           DepartmentType @default(Default)
  Employees      Employee[]
  Faculty        Faculty[]
}

model Document {
  DocumentID       Int              @id @default(autoincrement())
  FacultyID        Int
  employeeId       String?
  DocumentTypeID   Int
  UploadDate       DateTime?        @default(now())
  SubmissionStatus SubmissionStatus @default(Submitted)
  FilePath         String?
  FileUrl          String?
  DownloadUrl      String?
  retirementId     Int?
  DocumentType     DocumentType     @relation(fields: [DocumentTypeID], references: [DocumentTypeID])
  Faculty          Faculty          @relation(fields: [FacultyID], references: [FacultyID])
  Employee         Employee?        @relation(fields: [employeeId], references: [EmployeeID])
  Retirement       Retirement?      @relation(fields: [retirementId], references: [id])

  @@index([FacultyID])
  @@index([DocumentTypeID])
}

model DocumentType {
  DocumentTypeID   Int        @id @default(autoincrement())
  DocumentTypeName String     @unique
  AllowedFileTypes String[]
  Template         String?
  Document         Document[]
}

model LeaveTypes {
  LeaveTypeID   Int        @id @default(autoincrement())
  LeaveTypeName String     @unique
  NumberOfDays  Int?
}

model Contract {
  ContractID   Int          @id @default(autoincrement())
  StartDate    DateTime
  EndDate      DateTime
  ContractType ContractType
  Employees    Employee[]
  Faculty      Faculty[]
}

model Attendance {
  id         Int              @id @default(autoincrement())
  facultyId  Int
  employeeId String?
  date       DateTime         @default(now()) @db.Date
  timeIn     DateTime?        @db.Time(6)
  timeOut    DateTime?        @db.Time(6)
  remarks    String?
  createdAt  DateTime         @default(now())
  updatedAt  DateTime?        @updatedAt
  status     AttendanceStatus @default(NOT_RECORDED)
  Employee   Employee?        @relation(fields: [employeeId], references: [EmployeeID])
  Faculty    Faculty          @relation(fields: [facultyId], references: [FacultyID])
}

model Schedules {
  id             Int          @id @default(autoincrement())
  facultyId      Int
  subjectId      Int
  classSectionId Int
  day            String
  time           String
  duration       Int
  createdAt      DateTime     @default(now())
  updatedAt      DateTime?    @updatedAt
  classSection   ClassSection @relation(fields: [classSectionId], references: [id])
  faculty        Faculty      @relation(fields: [facultyId], references: [FacultyID])
  subject        Subject      @relation(fields: [subjectId], references: [id])
}

model AIChat {
  ChatID   Int    @id @default(autoincrement())
  UserID   String
  Question String
  Answer   String
  Status   String
  User     User   @relation(fields: [UserID], references: [UserID])
  dateSubmitted DateTime @default(now())
}

model ChatTopic {
  id        String      @id @default(cuid())
  userId    String
  title     String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  messages  ChatMessage[]
}

model ChatMessage {
  id        String   @id @default(cuid())
  topicId   String
  sender    String   // 'user' or 'bot'
  text      String
  timestamp DateTime @default(now())
  ChatTopic ChatTopic @relation(fields: [topicId], references: [id])
}

model TrainingDocument {
  id         String   @id @default(cuid())
  UserID     String
  title      String
  content    String
  keywords   String[] // Extracted keywords for better search
  sections   Json?    // Structured content sections for better retrieval
  fileUrl    String?
  fileType   String
  uploadedBy String
  uploadedAt DateTime @default(now())
  status     Status   @default(Active)
  User       User     @relation(fields: [UserID], references: [UserID])
}

model Report {
  ReportID      Int      @id @default(autoincrement())
  GeneratedBy   String
  ReportType    String
  GeneratedDate DateTime @default(now())
  Details       String
  User          User     @relation(fields: [GeneratedBy], references: [UserID])
}

model Notification {
  NotificationID Int      @id @default(autoincrement())
  UserID         String
  Message        String
  DateSent       DateTime @default(now())
  Type           String
  IsRead         Boolean  @default(false)
  User           User     @relation(fields: [UserID], references: [UserID])
}

model ActivityLog {
  LogID          Int      @id @default(autoincrement())
  UserID         String?
  ActionType     String?
  EntityAffected String?
  RecordID       Int?
  ActionDetails  String
  Timestamp      DateTime @default(now())
  IPAddress      String?
  User           User?    @relation(fields: [UserID], references: [UserID])
}

model Role {
  id    Int        @id @default(autoincrement())
  name  String     @unique
  users UserRole[]
}

model UserRole {
  userId String
  roleId Int
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [UserID], onDelete: Cascade)

  @@id([userId, roleId])
}

model Leave {
  LeaveID                 Int         @id @default(autoincrement())
  FacultyID               Int
  employeeId              String?
  RequestType             RequestType @default(Leave)
  LeaveType               LeaveType?
  StartDate               DateTime?
  EndDate                 DateTime?
  TimeIn                  DateTime?
  TimeOut                 DateTime?
  Reason                  String
  Status                  LeaveStatus @default(Pending)
  EmploymentType          String?
  employeeSignature       String?
  departmentHeadSignature String?
  CreatedAt               DateTime    @default(now())
  UpdatedAt               DateTime?   @updatedAt
  Faculty                 Faculty     @relation(fields: [FacultyID], references: [FacultyID])
  Employee                Employee?   @relation(fields: [employeeId], references: [EmployeeID])
}

model Vacancy {
  VacancyID         Int           @id @default(autoincrement())
  JobTitle          JobTitle
  VacancyName       String
  Description       String?
  HiringManager     String
  Status            VacancyStatus @default(Active)
  DatePosted        DateTime?
  DateCreated       DateTime      @default(now())
  DateModified      DateTime?     @updatedAt
  isDeleted         Boolean       @default(false)
  createdBy         String?
  updatedBy         String?
  NumberOfPositions Int           @default(1)
  Candidates        Candidate[]
  requirements      VacancyRequirement[]
  screenings        CandidateScreening[]
}

model Candidate {
  CandidateID   Int             @id @default(autoincrement())
  VacancyID     Int
  LastName      String
  FirstName     String
  MiddleName    String?
  ExtensionName String?
  FullName      String
  Email         String
  ContactNumber String?
  MessengerName String?
  FBLink        String?
  Sex           Sex?
  DateOfBirth   DateTime?       @db.Date
  Phone         String?
  DateApplied   DateTime        @default(now())
  InterviewDate DateTime?
  Status        CandidateStatus @default(ApplicationInitiated)
  Resume        String?
  ResumeUrl     String?
  isDeleted     Boolean         @default(false)
  DateCreated   DateTime        @default(now())
  DateModified  DateTime?       @updatedAt
  createdBy     String?
  updatedBy     String?
  Vacancy       Vacancy         @relation(fields: [VacancyID], references: [VacancyID])
  screenings    CandidateScreening[]
  // Employee information submission fields
  EmployeeInfoSubmitted     Boolean   @default(false)
  EmployeeInfoSubmittedDate DateTime? @db.Date
  Token                     String?   @unique
  TokenExpiry               DateTime?
  SubmittedEmployeeInfo     Json?
  InfoReturned              Boolean   @default(false)
  InfoReturnedDate          DateTime?
  InfoReturnReason          String?

  @@index([VacancyID])
  @@index([Token])
}

model Subject {
  id        Int         @id @default(autoincrement())
  name      String      @unique
  schedules Schedules[]
}

model ClassSection {
  id        Int         @id @default(autoincrement())
  name      String      @unique
  schedules Schedules[]
}

model Education {
  id            Int      @id @default(autoincrement())
  employeeId    String
  level         String
  schoolName    String
  course        String?
  yearGraduated Int?
  honors        String?
  employee      Employee @relation(fields: [employeeId], references: [EmployeeID])
}

model EmploymentHistory {
  id               Int       @id @default(autoincrement())
  employeeId       String
  schoolName       String
  position         String
  startDate        DateTime
  endDate          DateTime?
  reasonForLeaving String?
  employee         Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model PromotionHistory {
  id           Int       @id @default(autoincrement())
  employeeId   String
  fromPosition String?
  toPosition   String
  fromSalaryGrade String?
  toSalaryGrade   String?
  effectiveDate   DateTime
  promotionType   String?  // "Promotion", "Transfer", "Salary Adjustment", etc.
  remarks         String?
  approvedBy      String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime? @updatedAt
  createdBy       String?
  updatedBy       String?
  employee        Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model Skill {
  id                Int       @id @default(autoincrement())
  employeeId        String
  name              String
  proficiencyLevel  String
  yearsOfExperience Int
  description       String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime? @updatedAt
  employee          Employee  @relation(fields: [employeeId], references: [EmployeeID])

  @@map("skills")
}

model MedicalInfo {
  id                        Int       @id @default(autoincrement())
  employeeId                String    @unique
  medicalNotes              String?
  lastCheckup               DateTime?
  vaccination               String?
  allergies                 String?
  hasDisability             Boolean   @default(false)
  disabilityType            String?
  disabilityDetails         String?
  accommodationsNeeded      String?
  pwdIdNumber               String?
  pwdIdValidity             DateTime?
  disabilityCertification   String?
  disabilityPercentage      Int?
  assistiveTechnology       String?
  mobilityAids              String?
  communicationNeeds        String?
  workplaceModifications    String?
  emergencyProtocol         String?
  bloodPressure             String?
  height                    Float?
  weight                    Float?
  emergencyProcedures       String?
  primaryPhysician          String?
  physicianContact          String?
  healthInsuranceProvider   String?
  healthInsuranceNumber     String?
  healthInsuranceExpiryDate DateTime?
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime? @updatedAt
  createdBy                 String?
  updatedBy                 String?
  employee                  Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model Family {
  id            Int       @id @default(autoincrement())
  employeeId    String
  type          String
  name          String
  dateOfBirth   DateTime?
  occupation    String?
  isDependent   Boolean   @default(false)
  relationship  String?
  contactNumber String?
  address       String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime? @updatedAt
  employee      Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model Certificate {
  id          Int       @id @default(autoincrement())
  employeeId  String
  title       String
  issuedBy    String
  issueDate   DateTime
  expiryDate  DateTime?
  description String?
  fileUrl     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  employee    Employee  @relation(fields: [employeeId], references: [EmployeeID])

  @@map("certificates")
}

model Eligibility {
  id            Int       @id @default(autoincrement())
  employeeId    String
  type          String
  rating        Float?
  licenseNumber String?
  examDate      DateTime?
  validUntil    DateTime?
  Employee      Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model WebhookPending {
  id           Int       @id @default(autoincrement())
  type         String    @db.VarChar(50)
  invitationId String    @db.VarChar(255)
  userId       String    @db.VarChar(255)
  email        String    @db.VarChar(255)
  createdAt    DateTime  @default(now()) @db.Timestamp(6)
  processedAt  DateTime? @db.Timestamp(6)
  status       String?   @default("pending") @db.VarChar(50)
  error        String?

  @@index([invitationId], map: "webhook_pending_invitation_id_idx")
  @@index([status], map: "webhook_pending_status_idx")
  @@index([userId], map: "webhook_pending_user_id_idx")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model trainings {
  id          Int       @id @default(autoincrement())
  employeeId  String
  title       String
  hours       Int
  conductedBy String
  date        DateTime
  createdAt   DateTime  @default(now())
  updatedAt   DateTime?
  Employee    Employee  @relation(fields: [employeeId], references: [EmployeeID])
}

model PerformanceReview {
  id              String                @id @default(cuid())
  employeeId      String
  reviewerId      String
  period          String?               // e.g., "Q1 2024"
  startDate       DateTime              @db.Date
  endDate         DateTime              @db.Date
  kpiScore        Decimal?              @db.Decimal(5, 2)
  behaviorScore   Decimal?              @db.Decimal(5, 2)
  attendanceScore Decimal?              @db.Decimal(5, 2)
  totalScore      Decimal?              @db.Decimal(5, 2)
  status          PerformanceReviewStatus @default(draft)
  remarks         String?               @db.Text
  employeeComments String?              @db.Text
  goals           Json?                 // Future goals/objectives
  achievements    Json?                 // Key achievements
  improvementAreas Json?                // Areas for improvement
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  createdBy       String?
  updatedBy       String?
  reviewedAt      DateTime?             // When the review was completed
  approvedAt      DateTime?             // When the review was approved
  employee        Employee              @relation(fields: [employeeId], references: [EmployeeID])
  reviewer        User                  @relation("PerformanceReviewer", fields: [reviewerId], references: [UserID])
  performanceGoals PerformanceGoal[]     @relation("ReviewGoals")

  @@index([employeeId])
  @@index([reviewerId])
  @@index([status])
  @@index([startDate, endDate])
}

model DisciplinaryRecord {
  id                  String                @id @default(cuid())
  caseNo              String                @unique
  employeeId          String
  supervisorId        String?
  category            String                // e.g., "Attendance", "Behavior", "Performance", "Safety"
  violation           String                // Specific violation type
  severity            DisciplinarySeverity  @default(Minor)
  status              DisciplinaryStatus    @default(Ongoing)
  dateTime            DateTime              @default(now())
  resolution          String?               @db.Text
  resolutionDate      DateTime?             @db.Date
  remarks             String?               @db.Text
  interviewNotes      String?               @db.Text
  hrRemarks           String?               @db.Text
  recommendedPenalty  String?
  digitalAcknowledgment Boolean             @default(false)
  acknowledgedAt      DateTime?
  offenseCount        Int                   @default(1)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  createdBy           String?
  updatedBy           String?
  employee            Employee              @relation(fields: [employeeId], references: [EmployeeID])
  supervisor          User?                 @relation("DisciplinarySupervisor", fields: [supervisorId], references: [UserID])
  evidence            DisciplinaryEvidence[]
  actions             DisciplinaryAction[]

  @@index([employeeId])
  @@index([caseNo])
  @@index([status])
  @@index([severity])
  @@index([dateTime])
}

model DisciplinaryEvidence {
  id                  String            @id @default(cuid())
  disciplinaryRecordId String
  fileName            String
  fileType            String            // e.g., "pdf", "jpg", "doc"
  fileUrl             String
  fileSize            Int?              // in bytes
  uploadedAt          DateTime          @default(now())
  uploadedBy          String?
  description         String?
  disciplinaryRecord  DisciplinaryRecord @relation(fields: [disciplinaryRecordId], references: [id], onDelete: Cascade)

  @@index([disciplinaryRecordId])
}

model DisciplinaryCategory {
  id              Int                 @id @default(autoincrement())
  name            String              @unique
  description     String?             @db.Text
  isActive        Boolean             @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  createdBy       String?
  updatedBy       String?
  violationTypes  ViolationType[]

  @@index([isActive])
}

model ViolationType {
  id              Int                 @id @default(autoincrement())
  name            String              @unique
  categoryId      Int                 // Reference to DisciplinaryCategory
  defaultSeverity DisciplinarySeverity
  description     String?             @db.Text
  penaltyGuidelines String?            @db.Text
  isActive        Boolean             @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  createdBy       String?
  updatedBy       String?
  category        DisciplinaryCategory @relation(fields: [categoryId], references: [id])

  @@index([categoryId])
  @@index([isActive])
}

model PerformanceGoal {
  id              String              @id @default(cuid())
  employeeId      String
  performanceReviewId String?          // Optional link to a specific review
  title           String
  description     String?             @db.Text
  targetDate      DateTime            @db.Date
  status          PerformanceGoalStatus @default(NotStarted)
  progress        Int                 @default(0) // 0-100 percentage
  completionDate  DateTime?           @db.Date
  notes           String?             @db.Text
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  createdBy       String?
  updatedBy       String?
  employee        Employee            @relation(fields: [employeeId], references: [EmployeeID])
  review          PerformanceReview?  @relation("ReviewGoals", fields: [performanceReviewId], references: [id])

  @@index([employeeId])
  @@index([status])
  @@index([targetDate])
}

model PerformanceImprovementPlan {
  id                  String              @id @default(cuid())
  employeeId          String
  initiatedBy         String              // UserID of supervisor/HR who initiated
  startDate           DateTime            @db.Date
  endDate             DateTime            @db.Date
  reason              String              @db.Text
  objectives          Json                // Array of improvement objectives
  actionItems         Json                // Array of specific action items
  successCriteria     String?             @db.Text
  status              PIPStatus           @default(Active)
  progress            Int                 @default(0) // 0-100 percentage
  reviewFrequency     String?             // e.g., "Weekly", "Bi-weekly", "Monthly"
  lastReviewDate      DateTime?           @db.Date
  nextReviewDate      DateTime?           @db.Date
  outcome             PIPOutcome?
  outcomeDate         DateTime?           @db.Date
  notes               String?             @db.Text
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  createdBy           String?
  updatedBy           String?
  employee            Employee            @relation(fields: [employeeId], references: [EmployeeID])
  initiator           User                @relation("PIPInitiator", fields: [initiatedBy], references: [UserID])
  reviews             PIPReview[]

  @@index([employeeId])
  @@index([status])
  @@index([startDate, endDate])
}

model PIPReview {
  id                    String                    @id @default(cuid())
  pipId                 String
  reviewDate            DateTime                  @db.Date
  reviewedBy            String                    // UserID
  progress              Int                       // 0-100 percentage
  achievements          String?                   @db.Text
  challenges            String?                   @db.Text
  nextSteps             String?                   @db.Text
  employeeFeedback      String?                   @db.Text
  overallAssessment     String?                   @db.Text
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  pip                   PerformanceImprovementPlan @relation(fields: [pipId], references: [id], onDelete: Cascade)
  reviewer              User                      @relation("PIPReviewer", fields: [reviewedBy], references: [UserID])

  @@index([pipId])
  @@index([reviewDate])
}

model KPI {
  id              String              @id @default(cuid())
  name            String              @unique
  description     String              @db.Text
  category        KPICategory
  weight          Decimal             @db.Decimal(5, 2) // Percentage weight in total score calculation
  maxScore        Decimal             @db.Decimal(5, 2)
  minScore        Decimal             @db.Decimal(5, 2) @default(0)
  isActive        Boolean             @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  createdBy       String?
  updatedBy       String?

  @@index([category])
  @@index([isActive])
}

model PerformanceMetric {
  id              String              @id @default(cuid())
  employeeId      String
  metricName      String              // e.g., "Sales Target", "Customer Satisfaction", "Project Completion"
  metricType      PerformanceMetricType
  value           Decimal             @db.Decimal(10, 2)
  target          Decimal?            @db.Decimal(10, 2)
  unit            String?             // e.g., "percentage", "count", "currency"
  period          String              // e.g., "Q1 2024", "January 2024"
  periodStart     DateTime            @db.Date
  periodEnd       DateTime            @db.Date
  notes           String?             @db.Text
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  createdBy       String?
  updatedBy       String?
  employee        Employee            @relation(fields: [employeeId], references: [EmployeeID])

  @@index([employeeId])
  @@index([metricName])
  @@index([periodStart, periodEnd])
}

model DisciplinaryAction {
  id                  String                @id @default(cuid())
  disciplinaryRecordId String
  actionType          DisciplinaryActionType
  effectiveDate       DateTime              @db.Date
  endDate             DateTime?             @db.Date
  description         String                @db.Text
  status              DisciplinaryActionStatus @default(Active)
  completedAt         DateTime?             @db.Date
  notes               String?               @db.Text
  approvedBy          String?               // UserID
  approvedAt          DateTime?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  createdBy           String?
  updatedBy           String?
  disciplinaryRecord  DisciplinaryRecord    @relation(fields: [disciplinaryRecordId], references: [id], onDelete: Cascade)
  approver            User?                 @relation("DisciplinaryActionApprover", fields: [approvedBy], references: [UserID])
  appeals             DisciplinaryAppeal[]

  @@index([disciplinaryRecordId])
  @@index([actionType])
  @@index([status])
  @@index([effectiveDate])
}

model DisciplinaryAppeal {
  id                  String            @id @default(cuid())
  disciplinaryActionId String
  employeeId          String
  appealDate          DateTime          @default(now())
  reason              String            @db.Text
  supportingDocuments Json?             // Array of document references
  status              AppealStatus      @default(Pending)
  reviewedBy          String?           // UserID
  reviewedAt          DateTime?
  decision            String?           @db.Text
  decisionDate        DateTime?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  disciplinaryAction  DisciplinaryAction @relation(fields: [disciplinaryActionId], references: [id], onDelete: Cascade)
  employee            Employee          @relation(fields: [employeeId], references: [EmployeeID])
  reviewer            User?             @relation("AppealReviewer", fields: [reviewedBy], references: [UserID])

  @@index([disciplinaryActionId])
  @@index([employeeId])
  @@index([status])
  @@index([appealDate])
}

enum DepartmentType {
  Pre_School
  Primary
  Intermediate
  JHS
  Admin
  Default
}

enum Status {
  Invited
  Active
  Inactive
}

enum EmploymentStatus {
  Hired
  Resigned
  Regular
  Probationary
  Part_Time
  Retired
}

enum EmployeeType {
  Regular
  Probationary
  Part_Time
  Retired
  Resigned
}

enum SubmissionStatus {
  Submitted
  Pending
  Approved
  Returned
}

enum ContractType {
  Full_Time
  Part_Time
  Probationary
}

enum DayOfWeek {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  NOT_RECORDED
}

enum LeaveStatus {
  Pending
  Approved
  Returned
}

enum LeaveType {
  Sick
  Vacation
  Emergency
  Undertime
  Maternity
  Paternity
}

enum RequestType {
  Leave
  Undertime
}

enum JobTitle {
  HR_Manager
  Faculty
  Registrar
  Cashier
  Other
}

enum VacancyStatus {
  Active
  Inactive
  Filled
  Cancelled
  Withdrawn
}

enum CandidateStatus {
  ApplicationInitiated
  UnderReview
  Shortlisted
  InterviewScheduled
  InterviewCompleted
  Offered
  Hired
  Returned
  Withdrawn
}

enum Designation {
  President
  Admin_Officer
  Vice_President
  Registrar
  Faculty
  Principal
  Cashier
}

enum Role2 {
  APPLICANT
  EMPLOYEE
  ADMIN
}

enum Sex {
  Male
  Female
  Intersex
}

enum EmploymentType {
  FullTime
  Part_Time
}

enum RetirementStatus {
  NotEligible
  Approaching
  Eligible
  Processing
  Retired
}

enum RetirementProcessStatus {
  Pending
  DocumentsSubmitted
  ClearanceInProgress
  ExitInterviewScheduled
  ExitInterviewCompleted
  BenefitsProcessing
  Completed
  Cancelled
}

enum LeaveAccrualPeriod {
  MONTHLY
  YEARLY
  ONE_TIME
}

enum PerformanceReviewStatus {
  draft
  pending
  completed
  approved
}

enum DisciplinarySeverity {
  Minor
  Moderate
  Major
}

enum DisciplinaryStatus {
  Ongoing
  For_Review
  Resolved
  Closed
}

enum PerformanceGoalStatus {
  NotStarted
  InProgress
  OnTrack
  AtRisk
  Completed
  Cancelled
}

enum PIPStatus {
  Active
  OnHold
  Completed
  Terminated
  Extended
}

enum PIPOutcome {
  Successful
  PartiallySuccessful
  Unsuccessful
  Terminated
  Extended
}

enum KPICategory {
  kpi
  behavior
  attendance
  other
}

enum PerformanceMetricType {
  KPI
  Behavior
  Attendance
  Quality
  Productivity
  CustomerSatisfaction
  Other
}

enum DisciplinaryActionType {
  VerbalWarning
  WrittenWarning
  FinalWarning
  Suspension
  Demotion
  SalaryReduction
  Termination
  Probation
  Training
  Counseling
  Other
}

enum DisciplinaryActionStatus {
  Pending
  Active
  Completed
  Cancelled
  Appealed
}

enum AppealStatus {
  Pending
  UnderReview
  Approved
  Rejected
  Withdrawn
}

// AI Agent Models
model PerformanceModule {
  id                  String              @id @default(cuid())
  employeeId          String              @unique
  currentPosition     String?
  currentSalaryGrade  String?
  currentSalaryAmount Decimal?            @db.Decimal(10, 2)
  recommendedPosition String?
  recommendedSalaryGrade String?
  recommendedSalaryAmount Decimal?        @db.Decimal(10, 2)
  promotionEligibilityScore Decimal?      @db.Decimal(5, 2)
  promotionRecommendation String?          @db.Text
  lastPromotionDate   DateTime?           @db.Date
  yearsInCurrentPosition Float?
  status              PerformanceModuleStatus @default(Active)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  employee            Employee            @relation(fields: [employeeId], references: [EmployeeID])
  trainingRecommendations TrainingRecommendation[]
  
  @@index([employeeId])
  @@index([promotionEligibilityScore])
  @@index([status])
}

model TrainingRecommendation {
  id                    String            @id @default(cuid())
  performanceModuleId   String
  trainingTitle         String
  trainingDescription   String?           @db.Text
  priority              TrainingPriority  @default(Medium)
  reason                String?           @db.Text
  estimatedHours        Int?
  estimatedCost         Decimal?          @db.Decimal(10, 2)
  skillGap              String?
  status                TrainingRecommendationStatus @default(Pending)
  aiGenerated           Boolean           @default(true)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  performanceModule     PerformanceModule @relation(fields: [performanceModuleId], references: [id], onDelete: Cascade)
  
  @@index([performanceModuleId])
  @@index([priority])
  @@index([status])
}

model CandidateScreening {
  id                    String              @id @default(cuid())
  candidateId           Int
  vacancyId             Int
  overallScore           Decimal?            @db.Decimal(5, 2)
  resumeScore           Decimal?            @db.Decimal(5, 2)
  qualificationScore    Decimal?            @db.Decimal(5, 2)
  experienceScore       Decimal?            @db.Decimal(5, 2)
  skillMatchScore       Decimal?            @db.Decimal(5, 2)
  recommendation        CandidateRecommendation @default(Reject)
  aiAnalysis            String?             @db.Text
  strengths             Json?
  weaknesses            Json?
  missingQualifications Json?
  suggestedQuestions    Json?
  riskFactors           Json?
  status                ScreeningStatus     @default(Pending)
  screenedAt            DateTime?          @default(now())
  screenedBy            String?             @default("AI_AGENT")
  candidate             Candidate           @relation(fields: [candidateId], references: [CandidateID])
  vacancy               Vacancy             @relation(fields: [vacancyId], references: [VacancyID])
  
  @@unique([candidateId, vacancyId])
  @@index([overallScore])
  @@index([recommendation])
  @@index([status])
}

model VacancyRequirement {
  id                    String              @id @default(cuid())
  vacancyId             Int
  requirementType        RequirementType
  requirementText        String              @db.Text
  isRequired             Boolean             @default(true)
  weight                 Decimal?            @db.Decimal(5, 2)
  vacancy                Vacancy             @relation(fields: [vacancyId], references: [VacancyID])
  
  @@index([vacancyId])
  @@index([requirementType])
}

model TrainingNeedsAnalysis {
  id                    String              @id @default(cuid())
  employeeId             String
  analysisDate          DateTime            @default(now())
  currentSkills          Json?
  requiredSkills         Json?
  skillGaps              Json?
  trainingPlan           Json?
  priorityScore          Decimal?           @db.Decimal(5, 2)
  estimatedCompletion    DateTime?          @db.Date
  status                 TrainingAnalysisStatus @default(Pending)
  aiGenerated            Boolean             @default(true)
  employee               Employee            @relation(fields: [employeeId], references: [EmployeeID])
  
  @@index([employeeId])
  @@index([priorityScore])
  @@index([status])
}

model DisciplinaryRiskAnalysis {
  id                    String              @id @default(cuid())
  employeeId             String
  riskScore              Decimal?           @db.Decimal(5, 2)
  riskLevel              RiskLevel          @default(Low)
  riskFactors            Json?
  patternAnalysis        String?            @db.Text
  recommendedAction      String?            @db.Text
  lastAnalysisDate       DateTime           @default(now())
  employee               Employee           @relation(fields: [employeeId], references: [EmployeeID])
  
  @@index([employeeId])
  @@index([riskScore])
  @@index([riskLevel])
}

// AI Agent Enums
enum PerformanceModuleStatus {
  Active
  Inactive
  UnderReview
}

enum TrainingPriority {
  Low
  Medium
  High
  Critical
}

enum TrainingRecommendationStatus {
  Pending
  Approved
  Rejected
  Completed
  InProgress
}

enum CandidateRecommendation {
  StrongRecommend
  Recommend
  Consider
  Reject
  NeedsReview
}

enum ScreeningStatus {
  Pending
  Processing
  Completed
  Failed
}

enum RequirementType {
  Education
  Experience
  Skill
  Certification
  Language
  Other
}

enum TrainingAnalysisStatus {
  Pending
  InProgress
  Completed
  Archived
}

enum RiskLevel {
  Low
  Medium
  High
  Critical
}
